<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>drawit</title>
	<link rel="stylesheet" href="/static/index.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script src='/static/external/panzoom.min.js'></script>

</head>

<body>

	


	<div id="viewport">
		<div id="canvas-container">
			<canvas id="canva_index" width="3840" height="2160"></canvas>
		</div>
		<div >
			<a href="/plan" id="startbtn">  </a>
		</div>
	</div>
	</div>



	<script type="module">
		import { DrawingModule } from '/static/draw.js';
		import { Event, DrawingEventType } from "/static/events.js"
		const params = new URLSearchParams(window.location.search);
		const dumpName = params.get("name") || "index"; // default to "index" for index.html
		let dumpFile;
		//tries to import the specified dump file, falls back to index.js if not found
		try {
			const path = `/static/saved/${dumpName}.js`;
			dumpFile = await import(path);
		} catch (err) {
			console.warn(`Could not import /static/saved/${dumpName}.js, falling back to index`, err);
			try {
				dumpFile = await import('/static/saved/index.js');
			} catch (err2) {
				console.error('Fallback /static/saved/index.js not found', err2);
				dumpFile = { dumpBytes: new Uint8Array(0) };
			}
		}
		const dumpBytes = dumpFile.dumpBytes;
		const drawingModuleInstance = new DrawingModule("canva_index");
		//colors of the palette !

		let sleep = () => { };
			sleep = (ms) => {
				return new Promise(resolve => setTimeout(resolve, ms));
			}
		


		const events = Event.deserialize_list(dumpBytes.buffer);
		for (let i = 0; i < events.length; i++) {
			const event = events[i];
			await sleep(2)
			drawingModuleInstance.HandleEvent(event);
				
		}

	</script>


</body>

</html>